#!/usr/bin/env bash
set -e

dots=~/ansible
tags="$1"

if [ -z $tags ]; then
  echo "at least one tag must be given, e.g. 'dnf,npm' or 'all'"
  exit 1
fi

first_run=false
if ! [ -x "$(command -v ansible)" ]; then
  first_run=true
  sudo flatpak remote-add --if-not-exists flathub https://flathub.org/repo/flathub.flatpakrepo
  sudo dnf install ansible ansible-collection-community-general
fi

ansible-playbook -i "${dots}/hosts" "${dots}/configuration.yml" --ask-become-pass --tags $tags

source "${HOME}/.bashrc"
